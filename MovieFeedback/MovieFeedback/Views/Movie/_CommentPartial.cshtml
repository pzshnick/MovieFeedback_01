@model MovieFeedback.ViewModels.CommentViewModel

<div class="comment-block" style="margin-left:@(Model.Level * 50)px; border-left: 2px solid #6c757d; padding-left: 20px; margin-top: 12px;">
    <div class="d-flex justify-content-between">
        <div>
            <strong>@Model.Username</strong>
            <span class="text-muted">@Model.PostedAt.ToString("g")</span>
        </div>
        @if (User.Identity?.IsAuthenticated == true && (User.Identity.Name == Model.Username || User.IsInRole("Admin")))
        {
            <div class="dropdown">
                <button class="btn btn-sm rounded-circle" type="button" data-bs-toggle="dropdown" aria-expanded="false" style="background: rgba(255, 255, 255, 0.25);">
                    <i class="bi bi-three-dots-vertical text-white"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end glass-dropdown">
                    <li>
                        <a class="dropdown-item text-white" href="#" onclick="openEditCommentModal(@Model.CommentId, `@Model.Content`)">Edit</a>
                    </li>
                    <li>
                        <form method="post" asp-action="DeleteComment" asp-controller="Comment" onsubmit="return confirm('Are you sure you want to delete this comment?');">
                            <input type="hidden" name="commentId" value="@Model.CommentId" />
                            <button type="submit" class="dropdown-item text-danger">Delete</button>
                        </form>
                    </li>
                </ul>
            </div>
        }
    </div>

    <p>@Model.Content</p>

    @if (User.IsInRole("User") || User.IsInRole("Admin"))
    {
        <form method="post" asp-action="ReplyComment" asp-controller="Movie" class="mb-3">
            <input type="hidden" name="movieId" value="@ViewData["MovieId"]" />
            <input type="hidden" name="parentCommentId" value="@Model.CommentId" />
            <div class="mb-2">
                <textarea name="content" class="form-control form-control-sm glass-textarea" placeholder="Reply..." rows="2" style="resize:none;"></textarea>
            </div>
            <button type="submit" class="btn btn-sm btn-secondary">Submit Comment</button>
        </form>
    }

    @if (Model.Replies != null && Model.Replies.Any())
    {
        foreach (var reply in Model.Replies)
        {
            @await Html.PartialAsync("_CommentPartial", reply)
        }
    }
</div>